<div class="video-player-container">
  @if (isLoading()) {
    <div class="loading">
      <div class="spinner-large"></div>
    </div>
  } @else if (video()) {
    <div class="video-player-layout" [class.chat-open]="showLiveChat()">
      
      <!-- Main Content Area -->
      <div class="primary-content">
        <!-- Video Player (Regular or Live/Ended Stream) -->
        @if (showVideo()) {
          <div class="video-wrapper">
            @if (streamMessage() && streamStatus() !== 'regular') {
              <div class="stream-badge" 
                   [class.badge-ended]="streamStatus() === 'ended'" 
                   [class.badge-live]="streamStatus() === 'live'">
                <span class="material-icons">
                  {{ streamStatus() === 'ended' ? 'live_tv' : 'fiber_manual_record' }}
                </span>
                {{ streamMessage() }}
              </div>
            }
            <video #videoElement controls [src]="videoUrl()" class="video-element">
              Your browser does not support the video tag.
            </video>
          </div>
        } @else if (streamStatus() === 'not-started') {
        <!-- Scheduled Stream Not Started - Replaces Video Player -->
        <div class="video-placeholder">
          <div class="placeholder-content">
            <span class="material-icons placeholder-icon">schedule</span>
            <h3 class="placeholder-title">Live Stream Scheduled</h3>
            <p class="placeholder-message">{{ streamMessage() }}</p>
            <div class="placeholder-actions">
              <button (click)="checkIfStarted()" class="btn-check-now">
                <span class="material-icons">refresh</span>
                Check if Started
              </button>
            </div>
          </div>
        </div>
      }
        
        <div class="video-details">
          
          <h1 class="video-title">{{ video()?.title }}</h1>
          
          <div class="video-meta">
            <div class="meta-row">
              <div class="author-info">
                <span class="material-icons">account_circle</span>
                <span class="author-name">{{ video()?.username || 'Unknown' }}</span>
              </div>
              
              <div class="video-actions">
                <button (click)="onLike()" class="action-btn like-btn" [class.liked]="video()?.likedByCurrentUser">
                  <span class="material-icons">thumb_up</span>
                  @if (video()?.likes !== undefined) {
                    <span class="likes-count">{{ video()!.likes }}</span>
                  }
                </button>
                
                <!-- Live Chat Toggle Button - samo ako je stream LIVE -->
                @if (isStreamLive()) {
                  <button (click)="toggleLiveChat()" class="action-btn chat-toggle-btn" [class.active]="showLiveChat()">
                    <span class="material-icons">{{ showLiveChat() ? 'chat' : 'chat_bubble_outline' }}</span>
                    <span class="action-label">{{ showLiveChat() ? 'Hide Chat' : 'Show Chat' }}</span>
                  </button>
                }
              </div>
            </div>
          </div>
          
          @if (errorMessage()) {
            <div class="error-message">
              <span class="material-icons">error</span>
              {{ errorMessage() }}
            </div>
          }
          
          <div class="video-stats">
            @if (video()?.views !== undefined) {
              <span class="stat-item">
                <span class="material-icons">visibility</span>
                {{ video()!.views }} views
              </span>
            }
            <span class="stat-item">
              <span class="material-icons">calendar_today</span>
              {{ video()!.createdAt | date:'medium' }}
            </span>
          </div>
          
          @if (video()?.tags && (video()?.tags?.length ?? 0) > 0) {
            <div class="tags">
              @for (tag of video()?.tags; track tag) {
                <span class="tag">{{ tag }}</span>
              }
            </div>
          }
          
          <!-- Comments Section -->
          @if (video()?.id) {
            <div class="comments-wrapper">
              <app-video-comments [videoId]="video()!.id" />
            </div>
          }
        </div>
      </div>
      
      <!-- Live Chat Sidebar - samo kada je stream LIVE i chat je otvoren -->
      @if (isStreamLive() && showLiveChat() && video()?.id) {
        <aside class="live-chat-sidebar">
          <div class="chat-header">
            <h3>Live Chat</h3>
            <button (click)="toggleLiveChat()" class="close-btn" title="Close chat">
              <span class="material-icons">close</span>
            </button>
          </div>
          <div class="chat-content">
            <app-chat [streamId]="video()!.id" />
          </div>
        </aside>
      }
      
    </div>
  } @else if (errorMessage()) {
    <!-- Error State -->
    <div class="error-container">
      <div class="error-card">
        <span class="material-icons error-icon">error_outline</span>
        <h2 class="error-title">Oops! Something went wrong</h2>
        <p class="error-text">{{ errorMessage() }}</p>
        <button (click)="goBack()" class="btn-back">
          <span class="material-icons">arrow_back</span>
          Back to Home
        </button>
      </div>
    </div>
  }
</div>
