<div class="video-player-container">
  @if (isLoading()) {
    <div class="loading">
      <div class="spinner-large"></div>
    </div>
  } @else if (video()) {
    <div class="video-player-layout" [class.chat-open]="showLiveChat()">
      
      <!-- Main Content Area -->
      <div class="primary-content">
        
        <!-- Video Player -->
        @if (showVideo()) {
          <div class="video-wrapper">
            @if (streamMessage() && streamStatus() !== 'regular') {
              <div class="stream-badge" 
                   [class.badge-ended]="streamStatus() === 'ended'" 
                   [class.badge-live]="streamStatus() === 'live'">
                <span class="material-icons">
                  {{ streamStatus() === 'ended' ? 'live_tv' : 'fiber_manual_record' }}
                </span>
                {{ streamMessage() }}
              </div>
            }
            <video #videoElement controls [src]="videoUrl()" class="video-element">
              Your browser does not support the video tag.
            </video>
          </div>
        } @else if (streamStatus() === 'not-started') {
          <!-- Scheduled Stream Not Started -->
          <div class="video-placeholder">
            <div class="placeholder-content">
              <span class="material-icons placeholder-icon">schedule</span>
              <h3 class="placeholder-title">Live Stream Scheduled</h3>
              <p class="placeholder-message">{{ streamMessage() }}</p>
              <div class="placeholder-actions">
                <button (click)="loadVideo(video()!.id)" class="btn-check-now">
                  <span class="material-icons">refresh</span>
                  Check if Started
                </button>
              </div>
            </div>
          </div>
        }
        
        <!-- Video Info Section -->
        <div class="video-info">
          <h1 class="video-title">{{ video()?.title }}</h1>
          
          <div class="video-meta-bar">
            <div class="video-stats">
              @if (video()?.views !== undefined) {
                <span class="stat">{{ video()!.views }} views</span>
              }
              <span class="stat">{{ video()!.createdAt | date:'medium' }}</span>
            </div>
            
            <div class="video-actions">
              <!-- Live Chat Toggle - samo za live streamove -->
              @if (isStreamLive()) {
                <button (click)="toggleLiveChat()" class="action-btn" [class.active]="showLiveChat()">
                  <span class="material-icons">{{ showLiveChat() ? 'chat' : 'chat_bubble_outline' }}</span>
                  <span>Live Chat</span>
                </button>
              }
              
              <button (click)="onLike()" class="action-btn" [class.liked]="video()?.likedByCurrentUser">
                <span class="material-icons">thumb_up</span>
                <span>{{ video()?.likes || 0 }}</span>
              </button>
            </div>
          </div>
          
          @if (errorMessage()) {
            <div class="error-message">
              <span class="material-icons">error</span>
              {{ errorMessage() }}
            </div>
          }
          
          <!-- Channel Info -->
          <div class="channel-info">
            <div class="channel-details">
              <span class="material-icons channel-avatar">account_circle</span>
              <span class="channel-name">{{ video()?.username || 'Unknown' }}</span>
            </div>
          </div>
          
          <!-- Description -->
          @if (video()?.description) {
            <div class="video-description">
              <p>{{ video()?.description }}</p>
            </div>
          }
          
          <!-- Tags -->
          @if (video()?.tags && (video()?.tags?.length ?? 0) > 0) {
            <div class="tags">
              @for (tag of video()?.tags; track tag) {
                <span class="tag">{{ tag }}</span>
              }
            </div>
          }
        </div>
        
        <!-- Comments Section -->
        @if (video()?.id) {
          <div class="comments-wrapper">
            <app-video-comments [videoId]="video()!.id" />
          </div>
        }
      </div>
      
      <!-- Live Chat Sidebar - samo kada je stream LIVE i chat je otvoren -->
      @if (isStreamLive() && showLiveChat() && video()?.id) {
        <aside class="live-chat-sidebar">
          <div class="chat-header">
            <h3>Live Chat</h3>
            <button (click)="toggleLiveChat()" class="close-btn">
              <span class="material-icons">close</span>
            </button>
          </div>
          <div class="chat-content">
            <app-chat [streamId]="video()!.id" />
          </div>
        </aside>
      }
      
    </div>
  } @else if (errorMessage()) {
    <!-- Error State -->
    <div class="error-container">
      <div class="error-card">
        <span class="material-icons error-icon">error_outline</span>
        <h2 class="error-title">Oops! Something went wrong</h2>
        <p class="error-text">{{ errorMessage() }}</p>
        <button (click)="goBack()" class="btn-back">
          <span class="material-icons">arrow_back</span>
          Back to Home
        </button>
      </div>
    </div>
  }
</div>
